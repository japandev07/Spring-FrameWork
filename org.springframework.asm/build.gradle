description = 'Spring ASM'

configurations { jarjar }
dependencies { jarjar 'com.googlecode.jarjar:jarjar:1.1' }
configurations { asm }
dependencies { asm 'asm:asm:2.2.3@jar', 'asm:asm-commons:2.2.3@jar' }

jar << {
    project.ant {
        taskdef name: "jarjar", classname: "com.tonicsystems.jarjar.JarJarTask", classpath: configurations.jarjar.asPath
        jarjar(destfile: archivePath, index: "true", filesetmanifest: "merge") {
            configurations.asm.each { jarfile ->
                zipfileset(src: jarfile)
            }
            rule(pattern: 'org.objectweb.asm.**', result: 'org.springframework.asm.@1')
        }
    }
}

// TODO: integrate bundlor in jarjar routine
// TODO: create source jar
// TODO: review overall jarjar approach with Gradle team
